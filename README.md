# VerifyApp
Verify User App Signature In Driver

在Windows驱动中校验和驱动通讯的进程的签名是互联网大厂的一个常见做法。  
其中的一个做法是：校验文件的数字签名。  
但是微软的数字签名在有的版本上有缺陷，且CA机构也不停的更新。  
另一个做法是ProcessHacker，自己弄一个没有证书链的文件消息签名。  
本文是基于和参考此思路实现的。  
  
简单说下编译和测试的步骤吧！  
三个程序文件：签名程序，应用程序，驱动程序。  
三个数据文件：签名文件，公钥文件，私钥文件。  
第一步：先编译三个程序。  
第二步：运行签名程序。  
        &emsp;&emsp;&emsp;&emsp;这总会生成签名文件，  
        &emsp;&emsp;&emsp;&emsp;第一次运行会生成公私密钥，  
        &emsp;&emsp;&emsp;&emsp;或者不存在公私密钥不存在时也会生成。  
第三步：加载驱动程序。  
第四步：运行与驱动通讯的应用程序。  
        &emsp;&emsp;&emsp;&emsp;这个测试应该会成功。  
第五步：修改与驱动通讯的应用程序的文件的一个不重要的字节（确保程序能运行）。  
        &emsp;&emsp;&emsp;&emsp;并测试运行，  
        &emsp;&emsp;&emsp;&emsp;这个应该会失败。  
  
当然，私钥是不公开的，包括签名程序也是私密的。  
其次，公钥文件应该是嵌入在程序内部的，为了测试方便，这里生成临时文件，  
否则，知道签名算法，自己弄个私钥和公钥并签名，可以绕过本程序。  
最后，本程序不防Crack级别的攻击，如：在调试器下的篡改程序的行为。  
  
晋级流程：  
解析数字签名，验签数字证书，这个需要了解ASN1语法和证书的格式。  
在端上解密TLS（需要OpenSSL），除了上面的，还需了解协议包格式。  
  
2023/8/10
